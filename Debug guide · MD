# ๐ Quick Debug Guide - ุญู ูุดููุฉ "No valid image data found"

## ๐ฏ ุงููุฏู
ูุนุฑูุฉ **ุจุงูุถุจุท** ุฅูู ุงููู ุจูุฑุฌุน ูู OpenRouter API

---

## ๐ ุงูุฎุทูุงุช ุงูุณุฑูุนุฉ

### ุงูุฎุทูุฉ 1: ุชูุนูู Debug Logging

ูู Railway ุฃู ุงูุณูุฑูุฑุ ุฃุถู ูุชุบูุฑ ุงูุจูุฆุฉ:

```bash
LOG_LEVEL=DEBUG
```

ุฃู ูู ุงูููุฏ:
```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

### ุงูุฎุทูุฉ 2: ุดุบูู ุงููุตุฉ ูุฑุฉ ูุงุญุฏุฉ

ุงูุชุญ logs ุงูุณูุฑูุฑ ูุงุจุญุซ ุนู:
```
๐ OpenRouter Response:
Top keys: [...]
Message keys: [...]
Response preview: {...}
```

### ุงูุฎุทูุฉ 3: ุงูุณุฎ ุงูู logs ูุงุจุนุชูุง ูู

ุฃูุง ูุญุชุงุฌ ุฃุดูู:
1. `Top keys:`
2. `Message keys:`  
3. `Response preview:`

---

## ๐ง ุฎุทุฉ B: ุงุณุชุฎุฏุงู ููู Debug ุงููุณุชูู

ุฅุฐุง ูุง ูุฏุฑุชุด ุชุดูู ุงูู logs:

### 1. ุญููู `debug_openrouter.py`

### 2. ุนุฏูู ุงูุณุทุฑ:
```python
OPENROUTER_API_KEY = os.getenv("OPENROUTER_API_KEY", "YOUR_KEY_HERE")
```
ูุญุท ุงูููุชุงุญ ุจุชุงุนู

### 3. ุดุบููู:
```bash
python debug_openrouter.py
```

### 4. ููุทุจุน ุงูุงุณุชุฌุงุจุฉ ุงููุงููุฉ ูู OpenRouter

---

## ๐ก ุงูุฃุณุจุงุจ ุงููุญุชููุฉ

### ุงูุณุจุจ 1: ุงูุตูุฑุฉ ูู ููุงู ุบูุฑ ูุชููุน โ
```json
{
  "choices": [{
    "message": {
      "content": "https://image-url.com/img.png"  // โ ููุงุ
      // ุฃู
      "data": {"url": "..."}  // โ ุฃู ููุงุ
      // ุฃู
      "output": "base64..."  // โ ุฃู ููุงุ
    }
  }]
}
```

### ุงูุณุจุจ 2: ุงููููุฐุฌ ูุด ุจูุฏุนู modalities โ๏ธ
ุจุนุถ ุงูููุงุฐุฌ ุชุญุชุงุฌ format ูุฎุชูู:
```python
# ุจุฏู
"modalities": ["image"]

# ุฌุฑุจ
"response_format": {"type": "url"}
# ุฃู
"image_url": True
```

### ุงูุณุจุจ 3: ุงููููุฐุฌ ููุณู ูุด ุตุญ โ
FLUX Klein 4b ูุฏ ูุญุชุงุฌ:
- Plan ูุฏููุน
- Credits ูุงููุฉ
- Model ID ูุฎุชูู

---

## ๐ Checklist

ูุจู ูุง ุชุดุชุบู ุนูู ุงูุญูุ ุชุฃูุฏ ูู:

- [ ] โ OPENROUTER_API_KEY ููุฌูุฏ
- [ ] โ Credits/Balance ูุงูู ูู ุญุณุงุจู
- [ ] โ ุงููููุฐุฌ `black-forest-labs/flux.2-klein-4b` ูุชุงุญ ูุญุณุงุจู
- [ ] โ ุงูู request ุจููุตู (status 200)
- [ ] โ ูุงููุด error messages ูู ุงูู response

---

## ๐ฏ ุงูุชุดุฎูุต ุงูุณุฑูุน

**ูู ุงูู logs ุจุชููู:**

### โ `Response status: 200`
**ูุนูุงู:** ุงูุทูุจ ูุตู ุจูุฌุงุญ

### โ `Top keys: ['id', 'choices', 'model', ...]`
**ูุนูุงู:** ุงูุงุณุชุฌุงุจุฉ ุนุงุฏูุฉ

### โ `Message keys: ['content', 'role']` (ุจุฏูู 'images')
**ูุนูุงู:** ุงูุตูุฑุฉ ูุด ูู `images[]`ุ ูููู ูู `content`

### โ `content: "I cannot generate images"`
**ูุนูุงู:** ุงููููุฐุฌ ุฑุงูุถ ูููุฏ ุตูุฑุฉ (ูุดููุฉ ูู ุงูู plan ุฃู ุงูู model)

---

## ๐ ุงูุญููู ุงููุญุชููุฉ

### ุงูุญู 1: ูู ุงูุตูุฑุฉ ูู `content`
```python
# ูู _extract_image_from_response
content = message.get("content")
if content and isinstance(content, str):
    if content.startswith("http"):
        return content
```

### ุงูุญู 2: ูู ุงูุตูุฑุฉ ูู `data`
```python
data = message.get("data", {})
if isinstance(data, dict):
    return data.get("url") or data.get("image_url")
```

### ุงูุญู 3: ุชุบููุฑ ุงููููุฐุฌ
```python
# ุจุฏู FLUXุ ุฌุฑุจ ูููุฐุฌ ุขุฎุฑ
"model": "openai/dall-e-3"
# ุฃู
"model": "stability-ai/stable-diffusion-xl"
```

---

## ๐ ุงุจุนุชูู ุงููุนูููุงุช ุฏู:

ุนุดุงู ุฃูุฏุฑ ุฃุณุงุนุฏู ุจุฏูุฉุ ุฃูุง ูุญุชุงุฌ:

1. **ูุชูุฌุฉ ุงูู debug logging:**
   ```
   Top keys: [...]
   Message keys: [...]
   Response preview: {...}
   ```

2. **ุญุงูุฉ ุญุณุงุจู:**
   - ูู ุนูุฏู creditsุ
   - ุฅูู ุงูู plan ุจุชุงุนูุ

3. **ุฃู error messages** ูู ุงูู response

---

**ุจูุฌุฑุฏ ูุง ุชุจุนุชูู ุงููุนูููุงุช ุฏูุ ููุฏุฑ ุฃุนููู fix ุฏููู ููุถููู!** ๐ฏ

---

## ๐จ ุฅุฐุง ููุช ูู ุนุฌูุฉ:

**ุงูุญู ุงููุคูุช:**  
ุงุณุชุฎุฏู DALL-E 3 ูู OpenAI ุจุฏู FLUX:

```python
# ูู openai_service.pyุ ุบููุฑ:
"model": "black-forest-labs/flux.2-klein-4b"

# ุฅูู:
"model": "openai/dall-e-3"
```

ุนูู ุงูุฃูู ูุฏู ุงูุตูุฑ ูุชุดุชุบู ูุญุฏ ูุง ูุญู ูุดููุฉ FLUX. โ
