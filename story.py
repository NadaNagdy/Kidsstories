def generate_story(child_name, value, age_group):
    """
    Generates a story based on child's name, moral value, and age group.
    """
    # Normalize age group string if needed, e.g., "1-2" -> "1-2"
    
    templates = {
        "1-2": {
            "style": "صور كبيرة، كلمات بسيطة، تكرار.",
            "content": """
هذا {child_name}. (صورة طفل يبتسم)
{child_name} يحب اللعب.
{child_name} يشارك اللعبة.
شكراً {child_name}!
المشاركة جميلة.
"""
        },
        "2-3": {
            "style": "روتين يومي، جمل قصيرة.",
            "content": """
استيقظ {child_name} من النوم. "صباح الخير!".
غسل {child_name} وجهه.
أكل {child_name} فطوره اللذيذ.
ذهب {child_name} ليلعب.
وجد صديقه يبكي.
قال {child_name}: "لا تبك، خذ لعبتي".
ضحك الصديق.
{child_name} سعيد.
"""
        },
        "3-4": {
            "style": "مغامرة بسيطة، أسئلة تفاعلية.",
            "content": """
كان يا ما كان، أرنب صغير اسمه {child_name}.
كان {child_name} يقفز في الحديقة.
ماذا وجد {child_name}؟ وجد جزرة كبيرة!
هل أكلها وحده؟
لا، تذكر {child_name} أصدقاءه.
نادى {child_name}: "تعالوا يا أصدقاء!".
أكل الجميع وشبعوا.
قالوا: "شكراً يا {child_name}، أنت كريم!".
"""
        },
        "4-5": {
            "style": "أحداث متسلسلة، القرار الصحيح.",
            "content": """
في يوم مشمس، كان {child_name} يلعب بالكرة.
ركل {child_name} الكرة بقوة... طرااااخ!
انكسرت زهرية ماما المفضلة.
خاف {child_name} جداً. "ماذا أفعل؟ هل أخفيها؟".
تذكر {child_name} أن {value} هو الأهم.
ذهب {child_name} إلى ماما وقال: "أنا آسف، أنا كسرت الزهرية".
ابتسمت ماما وقالت: "أنا فخورة بك لأنك قلت الصدق يا {child_name}".
"""
        },
        "5-6": {
            "style": "مغامرة، حل مشكلة.",
            "content": """
البطل الخارق {child_name} يستعد لمهمة جديدة!
هناك قطة عالقة فوق الشجرة.
لبس {child_name} رداءه الأحمر.
حاول الوصول إليها لكنها بعيدة.
هل ييأس {child_name}؟ لا!
فكر {child_name} في فكرة ذكية.
أحضر سلم النجار وساعد القطة على النزول.
صاح الجميع: "يعيش البطل {child_name}!".
تعلم {child_name} أن {value} والشجاعة هما سر البطولة.
"""
        },
        "6-7": {
            "style": "مغامرة واضحة، تفكير.",
            "content": """
في مدرسة {child_name}، حدث شيء غريب.
اختفى قلم المعلمة المفضل!
بدأ الجميع يتبادلون الاتهامات.
وقف {child_name} وقال: "لحظة، لنفكر بهدوء".
بحث {child_name} في كل مكان، وسأل زملاءه بأدب.
وجد القلم تحت خزانة الكتب.
أعاده للمعلمة، ففرحت جداً بحكمته.
أثبت {child_name} أن {value} وحل المشكلات بهدوء هو تصرف الكبار.
"""
        },
        "7-8": {
            "style": "قصة مع تحديات، حبكة.",
            "content": """
كان {child_name} يحلم دائماً بالفوز في مسابقة الجري.
تدرب بجد كل يوم، وركض مسافات طويلة.
وفي يوم السباق، كان {child_name} في المقدمة!
فجأة، تعثر صديقه المنافس وسقط على الأرض.
توقف {child_name}. هل يكمل ويفوز؟ أم يساعد صديقه؟
تذكر {child_name} أن {value} والروح الرياضية أهم من الفوز.
عاد وساعد صديقه على النهوض، وأكملا السباق معاً.
خسر {child_name} المركز الأول، لكنه كسب احترام الجميع.
"""
        },
        "8-9": {
            "style": "مغامرة، صراع أخلاقي، تفاصيل.",
            "content": """
في قرية {child_name} الهادئة، كان هناك نهر جميل.
لاحظ {child_name} أن النهر بدأ يتلوث بسبب مصنع قريب.
كان صاحب المصنع رجلاً قوياً وغنياً.
خاف الجميع من التحدث إليه، إلا {child_name}.
جمع {child_name} أصدقاءه وكتبوا رسالة مهذبة وقوية للمحافظ، ونظفوا جزءاً من النهر بأنفسهم.
رأى الناس شجاعة {child_name} وانضموا إليه.
في النهاية، أجبر المصنع على حماية البيئة.
كان درساً في {value} والمسؤولية لن ينساه أحد.
"""
        },
        "default": {
             "style": "عام.",
             "content": """
كان يا ما كان، في قديم الزمان، كان هناك بطل اسمه {child_name}.
كان {child_name} يواجه تحديات كثيرة في حياته اليومية.
وفي كل مرة، كان يستخدم {value} ليتغلب على المصاعب.
لكن الدرس الأهم كان: {value} هو كنز لا يفنى.
"""
        }
    }

    story_data = templates.get(age_group, templates["default"])
    
    # If it's a dict (structured), return content formatted with actual values
    if isinstance(story_data, dict):
        return story_data["content"].format(child_name=child_name, value=value)
    return story_data.format(child_name=child_name, value=value)
